sudo: required
dist: trusty

language: cpp

git:
    depth: 3

branches:
    only:
    - master
    - build-system-trial

matrix:
  include:
    - os: linux
      services:
        - docker
      script:
        - docker build .


    - os: osx
      osx_image: xcode8
      cache:
        directories:
          - $HOME/Library/Caches/Homebrew
          - ./external
          - $HOME/3rdParty
      compiler: clang
      before_install:
        - brew update
        - brew outdated boost || brew upgrade boost
        - brew outdated cgal || brew upgrade cgal
        - brew tap osgeo/osgeo4mac && brew tap --repair
        - brew install gdal2 --with-armadillo --with-complete --with-libkml --with-unsupported
        - brew tap homebrew/science
        - brew install opencv3
        - brew ln opencv3 --force
        - mkdir build
        - mkdir build/darwin
      install:
        - cd build/darwin
        - cmake -DCGAL_DONT_OVERRIDE_CMAKE_FLAGS=ON ../..
      script:
        - make -j4 all
        - ./tests -a
        - rm *.off *.3ds *.shp *.shx *.dbf
